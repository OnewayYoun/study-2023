# Http

## IP 인터넷 프로토콜

- 지정한 IP 주소에 데이터 전달
- 패킷이라는 통신 단위로 데이터 전달

## IP 프로토콜의 한계

- 비연결성 - 패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송
- 비신뢰성 - 패킷이 순서대로 안오는경우, 중간에 손실나는 경우
- 프로그램 구분 - 같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 여러개이면?

## 인터넷 프로토콜 스택의 4계층

- 애플리케이션 계층 - HTTP,FTP
- 전송계층 - TCP, UDP
  - TCP 특징
    - 연결지향 - TCP 3way handshake (syn => syn+ack => ack)
    - 데이터 전달 보증
    - 순서보장
    - 현재 대부분 TCP 사용
  - UDP 특징(사용자 데이터그램 프로토콜)
    - 연결지향 X 데이터전달 보증 X 순서보장 X
    - 단순하고 빠름
    - IP와 거의 같지만 port ,체크섬 정도 추가 어플리케이션에서 추가 작업 필요
- 인터넷계층 - IP
- 네트워크 인터페이스 계층

## PORT

- 0~65535 할당 가능
- 0~1023: 잘 알려진 포트, 사용하지 않는 것이 좋음
- FTP - 20,21 TELNET -23 HTTP -80 HTTPS -443

## DNS (도메인 네임 시스템)

- 예) google.com

## HTTP

- 클라이언트 서버 구조
  - Request,Response 구조
- Stateless (무상태 프로토콜)
  - 서버가 클라이언트의 상태를 보존X
  - 장점 서버 확장성 높음
  - 단점 클라이언트가 추가 데이터 전송해줘야함
- 비연결성
  - HTTP는 기본이 연결을 유지하지 않는 모델
  - 서버 자원을 효율적으로 사용 가능
  - TCP/IP 연결을 계속 새로 맺어야하는 단점이 있음
  - HTTP 지속연결(Persisten Connections)로 문제 해결
- HTTP메시지

## HTTP 메서드

- API URI는 리소스를 URI에 매핑 (/member)로해서 get,post,put,delete...
- GET:리소스 조회
- POST:요청 데이터 처리, 주로 등록
- PUT:리소스를 대체, 해당 리소스가 없으면 생성
  - POST와 차이점은 PUT은 리소스 위치를 알고 URI 지정
  - ex) PUT /member/{id}
- PATCH: 리소스 부분 변경
  - PUT과 차이점은 PUT은 하나만 바꿔도 전체가 다 바뀐다.
  - EX)PUT : name,age를 가진 객체에 age만 바꾸면 name초기화된다
  - patch: name,age를 가진 객체에 age만 바꾸면 age만 바뀐다
- DELETE: 리소스 삭제

## HTTP 메서드 속성

- 안전(Safe Methods)
  - 호출해도 리소스를 변경하지 않는다
- 멱등(Idempotent Methods)
  - 한번 호출하든 두번 호출하든 100번 호출하든 결과가 똑같다.
  - GET,PUT,DELETE /// POST(결제)는 아님
  - 자동 복구 메커니즘에 활용
- 캐시가능(Cacheable Methods)
  - 주로 GET,정도만 캐시로 사용

## HTTP 메서드 데이터 전달 방식

- 쿼리 파라미터를 통한 데이터 전송
  - GET,주로 정렬 필터(검색어)
- 메시지 바디를 통한 데이터 전송
  - POST,PUT,PATCH
  - 회원가입, 상품주문,리소스 등록,리소스 변경

## HTTP 데이터 전달 4가지 상황

- 정적 데이터 조회
  - 이미지, 정적테스트 문서
- 동적 데이터 조회
  - 검색,게시판 목록 정렬 필터(검색어)
- HTML Form을 통한 데이터 전송
  - 회원가입,상품주문,데이터변경
- HTTP API를 통한 데이터 전송
  - 회원가입,상품주문,데이터 변경
  - 서버to서버,앱클라이언트,웹클라이언트(Ajax)

## 상태 코드

- 클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능
  - 1xx (Informational): 요청이 수신되어 처리중
  - 2xx (Successful): 요청 정상 처리
  - 3xx (Redirection): 요청을 완료하려면 추가 행동이 필요
  - 4xx (Client Error): 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
  - 5xx (Server Error): 서버 오류, 서버가 정상 요청을 처리하지 못함

# Throttling

 - Throttling은 리소스 사용량이나 요청 수 등을 일정 수준 이내로 제한하는 방법 
 - 특히 웹 서비스나 API에서 과도한 요청이 서버에 부담을 주는 것을 막기 위해 사용됩니다.

 - 구현 알고리즘
   1. 토큰 버킷 (Token Bucket)

      - 특징: 일정한 속도로 토큰이 버킷에 추가되며, 요청이 있을 때마다 토큰이 사용됩니다. 버킷에 저장될 수 있는 토큰의 최대 수는 제한되어 있습니다.
      - 장점: 일시적인 요청의 폭증에 유연하게 대응할 수 있습니다.
      - 단점: 설정에 따라 과도한 요청이 허용될 수 있습니다.

   2. 르누아르 계수 (Leaky Bucket)

      - 특징: 일정한 속도로 요청을 처리하며, 처리할 수 없는 요청은 '누출'로 처리됩니다. 주로 버퍼(queue)에 요청을 저장하며, 일정한 속도로 버퍼에서 요청을 꺼내 처리합니다.
      - 장점: 일관된 요청 처리 속도를 유지할 수 있습니다.
      - 단점: 급작스런 트래픽 폭증에는 유연하게 대응하기 어렵습니다.

   3. 슬라이딩 윈도우 로그 (Sliding Window Log)
       
	  - 특징: 윈도우 크기 내에서의 요청 로그를 유지하며, 이 윈도우 내의 요청 수가 특정 수를 초과하면 추가 요청을 거부합니다.
      - 장점: 최근의 트래픽 패턴을 반영하여 요청 제한이 가능합니다.
      - 단점: 로그 관리로 인한 추가적인 메모리 사용이 필요할 수 있습니다.

   4. 고정 윈도우 (Fixed Window)

      - 특징: 일정한 시간 구간으로 윈도우를 나누고, 해당 구간 내에서의 요청 수를 카운트합니다.
      - 장점: 구현이 간단하고, 메모리 사용량이 예측 가능합니다.
      - 단점: 윈도우 경계에서 요청 폭증이 발생할 경우, 예상보다 많은 요청이 허용될 수 있습니다.
	  
[출처] https://etloveguitar.tistory.com/126 ~ 130

# 웹 통신의 흐름

 1. 사용자가 웹 브라우저 검색창에 www.naver.com 입력
 2. 웹브라우저는 해당 도메인 주소와 상응하는 IP 주소를 찾기 위해 캐싱된 DNS 기록 확인
 3. 만약 캐시가 없다면 ISP의 DNS 서버는 IP주소를 찾기 위해 DNS query 시작
 4. DNS가 웹 브라우저에게 찾는 사이트의 IP 주소를 응답
 5. IP 주소를 받으면 일반적으로 TCP 통신 시작
 6. HTTP 프로토콜로 요청 
 7. WAS에서의 작업 처리 결과들을 웹 서버로 전송
 8. 웹서버는 웹 브라우저에게 html 문서 결과를 응답
 9. 웹 브라우저는 html 컨텐츠 표시
 
 ## 웹 서버
  - 정적인 컨텐츠(HTML, CSS, IMAGE) 요청받아 처리하여 제공하는 서버
  - Apache Server, Nginx등
  
 ## WAS
  - 동적인 컨텐츠(JSP,ASP,PHP등)을 요청받아 처리하여 제공하는 서버
  - Tomcat,JBoss,Jeus,Web Spehere 등
  
# HTTP 통신과 Socket통신

 - Http 통신은 클라이언트에서 서버로 요청을 보내고 서버가 응답이 이루어지는 통신(단방향)
 - 소켓통신이란 서버와 클라이언트 양뱡향 연결이 이루어지는 통신